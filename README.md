# Geo summary

Скрипт анализирует данные о местонахождении устройств, определяет для каждого устройства адрес его первого или последнего местонахождения (в зависимости от указанного параметра командной строки) и сохраняет эту информацию в таблицу.

## Входные данные

Скрипт использует данные из следующих источников:
1. База данных MySQL - ID устройств.
2. База данных Oracle - данные о первом местоположении устройств.
3. База данных PostgreSQL с расширением PostGIS (starlinemaps) - таблицы OSM.
4. База данных PostgreSQL с расширением PostGIS (geo_sum) - предыдущие результаты работы скрипта.
5. База данных Redis - данные о последнем местоположении устройств.
6. Сервис TimezoneServer - данные о часовом поясе.

## Выходные данные

Результаты работы скрипта сохраняются в таблицу geo_summary базы данных PostgreSQL. Структура таблицы geo_summary приведена в файле "Geo_summary_table".

## Алгоритм работы скрипта
![](https://github.com/DaryaPanarina/geo_summary/raw/master/Algorithm.jpg)

## Запуск скрипта

`python3 main.py [-c path] [-f] [-h]`

`-c path`		Путь к конфигурационному файлу. Шаблон конфигурационного файла представлен в файле "config_example.yaml".

`-f, --first`	Если ключ указан, то для каждого устройства скрипт определит адрес его первого местоположения, если не указан - то будет определяться адрес последнего местоположения для каждого устройства.

`-h, --help`	Справка.

## Содержимое репозитория

1. Исходный код скрипта: `main.py`, `Connection.py`.
2. Описание таблицы geo_summary: `Geo_summary_table`.
3. Пример конфигурационного файла: `config_example.yaml`.
4. Protobuf-структура данных, получаемых из Redis: `gps_data.proto`.
	
  Генерация класса для работы с данными из Protobuf:
  
  `protoc -I=$SRC_DIR --python_out=$DST_DIR $SRC_DIR/gps_data.proto`
  
5. Используемые в скрипте модули: `requirements.txt`.
6. README.
